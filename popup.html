<!DOCTYPE html>
<html>
  <head>
    <style>
      body { width: 300px; padding: 16px; font-family: Arial, sans-serif; }
      .header { margin-bottom: 16px; }
      .input-group { margin-bottom: 12px; }
      input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
      button { width: 100%; padding: 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
      button:hover { background: #0056b3; }
      .status { margin-top: 12px; padding: 8px; border-radius: 4px; font-size: 12px; }
      .status.success { background: #d4edda; color: #155724; }
      .status.error { background: #f8d7da; color: #721c24; }
    </style>
  </head>
  <body>
    <div class="header">
      <h3>Smart Gmail Writer</h3>
      <p>Configure your OpenAI API key to start generating AI email replies.</p>
    </div>
    
    <div class="input-group">
      <input type="password" id="key" placeholder="Enter OpenAI API key (sk-...)" />
    </div>
    
    <button id="save">Save API Key</button>
    
    <div id="status" class="status" style="display: none;"></div>
    
    <script>
      // Load existing API key on popup open
      chrome.storage.sync.get("openai_key", (result) => {
        if (result.openai_key) {
          document.getElementById("key").value = result.openai_key;
          showStatus("API key loaded", "success");
        }
      });

      document.getElementById("save").onclick = () => {
        const val = document.getElementById("key").value.trim();
        
        if (!val) {
          showStatus("Please enter an API key", "error");
          return;
        }
        
        if (!val.startsWith("sk-")) {
          showStatus("Invalid API key format. Should start with 'sk-'", "error");
          return;
        }
        
        chrome.storage.sync.set({ openai_key: val }, () => {
          showStatus("API key saved successfully!", "success");
        });
      };
      
      function showStatus(message, type) {
        const statusDiv = document.getElementById("status");
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
        statusDiv.style.display = "block";
        
        if (type === "success") {
          setTimeout(() => {
            statusDiv.style.display = "none";
          }, 3000);
        }
      }
    </script>
  </body>
</html>